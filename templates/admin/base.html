{% extends "base/base.html" %}
{% load i18n static %}

{% block title %}{% if subtitle %}{{ subtitle }} | {% endif %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extra_css %}
{{ block.super }}
    <!-- Admin CSS customizado -->
    <link rel="stylesheet" href="{% static 'css/admin/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin/changelist.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin/forms.css' %}">
    <link rel="stylesheet" href="{% static 'css/admin/enhancements.css' %}">
    
    {% block extrahead %}{% endblock %}
    {% block responsive %}
        <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="{% static 'admin/css/responsive.css' %}">
        {% if 'grappelli' in settings.INSTALLED_APPS %}<link rel="stylesheet" href="{% static 'admin/css/responsive_rtl.css' %}">{% endif %}
    {% endblock %}
    {% block blockbots %}<meta name="robots" content="NONE,NOARCHIVE">{% endblock %}
{% endblock %}

{% block content %}
<!-- Breadcrumb para admin -->
<div class="container-fluid mt-3">
    <nav aria-label="breadcrumb" class="admin-breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="{% url 'core:dashboard' %}">Início</a></li>
            <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">Administração</a></li>
            {% block breadcrumb_items %}{% endblock %}
        </ol>
    </nav>
</div>

<!-- Conteúdo principal do admin -->
<div class="container-fluid">
    <div class="main" id="main">
        {% block pretitle %}{% endblock %}
        {% block content_title %}{% if title %}<h1>{{ title }}</h1>{% endif %}{% endblock %}
        {% block content_subtitle %}{% if subtitle %}<h2>{{ subtitle }}</h2>{% endif %}{% endblock %}
        {% block admin_content %}
        {{ content }}
        {% endblock %}
        {% block sidebar %}{% endblock %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<!-- Django Admin JS -->
<script src="{% static 'admin/js/core.js' %}"></script>

<!-- Admin-specific enhancements (use main site's theme and navigation) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Melhorar a exibição do avatar no menu (apenas se não foi já aplicado pelo main.js)
    setTimeout(function() {
        const userDropdown = document.querySelector('#userDropdown');
        if (userDropdown && !userDropdown.querySelector('img')) {
            {% if user.is_authenticated and user.profile.avatar %}
            // Se o usuário tem avatar, substituir o ícone padrão
            const avatarImg = document.createElement('img');
            avatarImg.src = '{{ user.profile.avatar.url }}';
            avatarImg.alt = 'Avatar de {{ user.get_full_name|default:user.username }}';
            avatarImg.className = 'rounded-circle me-1';
            avatarImg.style.width = '24px';
            avatarImg.style.height = '24px';
            avatarImg.style.objectFit = 'cover';
            
            const icon = userDropdown.querySelector('.bi-person-circle');
            if (icon) {
                icon.replaceWith(avatarImg);
            }
            {% endif %}
        }
    }, 100);
});
</script>

{% block extrajs %}{% endblock %}
{% endblock %}
